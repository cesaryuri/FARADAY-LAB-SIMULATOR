<!DOCTYPE html>
<html lang="pt-BR" class="h-full antialiased">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Faraday Lab Pro - Completo</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'], mono: ['Fira Code', 'monospace'] },
          colors: {
            scope: { bg: '#111827', grid: '#1f2937', line: '#10b981', text: '#34d399' }
          },
          animation: {
            'spin-slow': 'spin 3s linear infinite',
            'pulse-fast': 'pulse 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    input[type=range] {
      -webkit-appearance: none;
      background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 18px;
      width: 18px;
      border-radius: 50%;
      background: #3b82f6; /* Blue thumb standard */
      cursor: pointer;
      margin-top: -7px;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
      transition: all 0.2s;
    }
    /* Specific slider for the Faraday bar (Amber) */
    .slider-amber::-webkit-slider-thumb {
        background: #f59e0b;
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.2);
    }
    .slider-amber::-webkit-slider-thumb:hover {
        box-shadow: 0 0 0 6px rgba(245, 158, 11, 0.3);
    }

    input[type=range]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.3);
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #e2e8f0;
      border-radius: 2px;
    }
    
    .bg-grid {
      background-size: 40px 40px;
      background-image:
        linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    }

    /* Dot pattern for Faraday Sim (Matches image) */
    .bg-dots {
        background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
        background-size: 20px 20px;
    }
    
    /* Padrão de listras para a bobina do anel */
    .coil-pattern {
      background-color: #7c2d12;
      background-image: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(255, 255, 255, 0.1) 10px,
        rgba(255, 255, 255, 0.1) 20px
      );
    }
  </style>
</head>
<body class="h-full bg-slate-50 text-slate-800">

<div id="root"></div>

<script type="text/babel">

const { useState, useEffect, useRef } = React;

// --- COMPONENTES UI BÁSICOS ---

const Card = ({ title, subtitle, icon, children, className="" }) => (
  <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col ${className}`}>
    <div className="bg-slate-50/50 border-b border-slate-100 p-4 flex items-center justify-between">
      <div className="flex items-center gap-3">
        {icon && <div className="p-2 bg-white rounded-lg border border-slate-200 shadow-sm text-blue-600"><i data-lucide={icon} className="w-5 h-5"></i></div>}
        <div>
          <h2 className="text-base font-bold text-slate-800 leading-tight">{title}</h2>
          {subtitle && <p className="text-xs text-slate-500 font-medium">{subtitle}</p>}
        </div>
      </div>
    </div>
    <div className="p-6 flex-grow relative">
      {children}
    </div>
  </div>
);

const FormulaBlock = ({ title, formula, description, quote }) => (
  <div className="bg-slate-900 text-slate-200 p-6 rounded-xl text-sm border border-slate-800 shadow-md">
    <h4 className="font-bold text-white mb-4 flex items-center gap-2 border-b border-slate-700 pb-2">
      <i data-lucide="book-open" className="w-4 h-4 text-amber-400"></i> {title}
    </h4>
    {description && <p className="mb-4 text-slate-300 leading-relaxed">{description}</p>}
    <div className="flex justify-center items-center bg-black/30 py-4 px-4 rounded-lg border border-slate-700/50 shadow-inner mb-4">
        <span className="text-2xl font-serif text-yellow-400 font-bold tracking-wider">
          {formula}
        </span>
    </div>
    {quote && (
      <p className="text-xs text-slate-400 leading-relaxed italic border-l-2 border-slate-600 pl-3">
          {quote}
      </p>
    )}
  </div>
);

const Oscilloscope = ({ dataLines, height = 200, timeScale = 1, yRange = 100 }) => {
  const canvasRef = useRef(null);

  useEffect(() => {
    const cvs = canvasRef.current;
    if (!cvs) return;
    const ctx = cvs.getContext('2d');
    const w = cvs.width = cvs.clientWidth * 2;
    const h = cvs.height = height * 2;
    
    ctx.scale(2, 2);
    const renderW = w / 2;
    const renderH = h / 2;

    ctx.clearRect(0, 0, renderW, renderH);

    ctx.strokeStyle = '#1f2937';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, renderH / 2); 
    ctx.lineTo(renderW, renderH / 2);
    ctx.stroke();

    dataLines.forEach(line => {
      if (!line.data || line.data.length < 2) return;

      ctx.beginPath();
      ctx.lineWidth = 2;
      ctx.strokeStyle = line.color || '#10b981';
      ctx.lineJoin = 'round';

      const step = renderW / (line.data.length - 1);
      
      line.data.forEach((val, i) => {
        const y = (renderH / 2) - (val / yRange) * (renderH / 2 * 0.8);
        if (i === 0) ctx.moveTo(0, y);
        else ctx.lineTo(i * step, y);
      });
      ctx.stroke();
    });

  }, [dataLines, height, yRange]);

  return (
    <div className="rounded-lg overflow-hidden bg-scope-bg border border-slate-700 shadow-inner relative">
       <div className="absolute inset-0 bg-grid pointer-events-none opacity-30"></div>
       <canvas ref={canvasRef} className="w-full block" style={{ height: `${height}px` }} />
       <div className="absolute bottom-2 right-2 text-[10px] font-mono text-scope-text opacity-70">
         {timeScale}ms/div
       </div>
    </div>
  );
};

const GraphCanvas = ({ drawFn, width=400, height=200, className="" }) => {
  const ref = useRef(null);
  useEffect(() => {
    const cvs = ref.current;
    if(!cvs) return;
    const ctx = cvs.getContext('2d');
    cvs.width = width * 2;
    cvs.height = height * 2;
    ctx.scale(2, 2);
    
    ctx.fillStyle = '#0f172a';
    ctx.fillRect(0, 0, width, height);
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 1;
    ctx.beginPath();
    for(let x = 0; x < width; x += 20) { ctx.moveTo(x,0); ctx.lineTo(x,height); }
    for(let y = 0; y < height; y += 20) { ctx.moveTo(0,y); ctx.lineTo(width,y); }
    ctx.stroke();

    drawFn(ctx, width, height);
  }, [drawFn, width, height]);
  
  return <canvas ref={ref} style={{width, height}} className={`rounded border border-slate-700 ${className}`}/>;
};

// --- SIMULADORES ATUALIZADOS ---

const BetatronSim = () => {
  const [bFieldRate, setBFieldRate] = useState(1);
  const [electrons, setElectrons] = useState([]);
  const canvasRef = useRef(null);
  const timeRef = useRef(0);

  useEffect(() => {
    const count = 30;
    const initialElectrons = Array.from({ length: count }).map((_, i) => ({
      angle: (i * Math.PI * 2) / count,
      speed: 0.5,
      radiusBase: 120 + (Math.random() - 0.5) * 20,
      radius: 120,
      trail: []
    }));
    setElectrons(initialElectrons);
  }, []);

  useEffect(() => {
    let anim;
    const loop = () => {
      timeRef.current += 0.05 * bFieldRate;
      
      const currentB = Math.sin(timeRef.current * 0.5);
      const inducedE = -Math.cos(timeRef.current * 0.5) * bFieldRate; 

      setElectrons(prev => prev.map(e => {
        let newSpeed = e.speed + (inducedE * 0.08); 
        newSpeed *= 0.99; 
        
        let newAngle = e.angle + newSpeed * 0.1;
        let newRadius = e.radiusBase + Math.sin(timeRef.current * 2 + e.angle) * 5;

        const newTrail = [...e.trail, { x: 0, y: 0, opacity: 1 }];
        if (newTrail.length > 10) newTrail.shift();

        return {
          ...e,
          angle: newAngle,
          speed: newSpeed,
          radius: newRadius,
          trail: newTrail.map((t, i) => ({...t, opacity: i/10}))
        };
      }));

      const cvs = canvasRef.current;
      if (cvs) {
        if (cvs.width !== cvs.clientWidth * 2) {
            cvs.width = cvs.clientWidth * 2;
            cvs.height = cvs.clientHeight * 2;
        }
        
        const ctx = cvs.getContext('2d');
        const w = cvs.width;
        const h = cvs.height;
        const cx = w/2;
        const cy = h/2;
        const scale = 1.5;

        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, 0, w, h);
        
        ctx.strokeStyle = '#1e293b';
        ctx.lineWidth = 1;
        ctx.beginPath();
        const gridSize = 40;
        for(let i=0; i<w; i+=gridSize) { ctx.moveTo(i,0); ctx.lineTo(i,h); }
        for(let i=0; i<h; i+=gridSize) { ctx.moveTo(0,i); ctx.lineTo(w,i); }
        ctx.stroke();
        
        const bIntensity = Math.abs(currentB);
        const bColorBase = currentB > 0 ? '59, 130, 246' : '239, 68, 68'; 
        
        const bGradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, 100 * scale);
        bGradient.addColorStop(0, `rgba(${bColorBase}, ${bIntensity * 0.8})`);
        bGradient.addColorStop(0.4, `rgba(${bColorBase}, ${bIntensity * 0.3})`);
        bGradient.addColorStop(1, 'rgba(0,0,0,0)');
        
        ctx.fillStyle = bGradient;
        ctx.beginPath();
        ctx.arc(cx, cy, 100 * scale, 0, Math.PI*2);
        ctx.fill();

        ctx.fillStyle = '#fff';
        ctx.font = 'bold 32px monospace';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.globalAlpha = Math.max(0.3, bIntensity);
        ctx.fillText(currentB > 0 ? "⊙ B" : "⊗ B", cx, cy);
        ctx.globalAlpha = 1;

        ctx.shadowBlur = 0;
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 2;
        
        ctx.beginPath(); 
        ctx.arc(cx, cy, 160 * scale, 0, Math.PI*2); 
        ctx.stroke();
        
        ctx.beginPath(); 
        ctx.arc(cx, cy, 90 * scale, 0, Math.PI*2); 
        ctx.stroke();

        ctx.fillStyle = 'rgba(30, 41, 59, 0.3)';
        ctx.beginPath();
        ctx.arc(cx, cy, 160 * scale, 0, Math.PI*2);
        ctx.arc(cx, cy, 90 * scale, 0, Math.PI*2, true);
        ctx.fill();

        const eAlpha = Math.min(Math.abs(inducedE) * 0.8, 1);
        if (eAlpha > 0.1) {
             ctx.strokeStyle = `rgba(251, 191, 36, ${eAlpha})`; 
             ctx.lineWidth = 4;
             ctx.setLineDash([10, 15]);
             ctx.beginPath();
             ctx.arc(cx, cy, 125 * scale, 0, Math.PI*2);
             ctx.stroke();
             ctx.setLineDash([]);
        }

        electrons.forEach(e => {
          const x = cx + Math.cos(e.angle) * (e.radius * scale);
          const y = cy + Math.sin(e.angle) * (e.radius * scale);
          
          for(let j=1; j<=8; j++) {
             const trailAngle = e.angle - (e.speed * 0.1 * j);
             const tx = cx + Math.cos(trailAngle) * (e.radius * scale);
             const ty = cy + Math.sin(trailAngle) * (e.radius * scale);
             
             ctx.fillStyle = `rgba(74, 222, 128, ${0.4 - (j * 0.05)})`;
             ctx.beginPath();
             ctx.arc(tx, ty, 2 + (3 - j*0.3), 0, Math.PI*2);
             ctx.fill();
          }

          const pGrad = ctx.createRadialGradient(x, y, 0, x, y, 10);
          pGrad.addColorStop(0, '#fff');
          pGrad.addColorStop(0.3, '#4ade80');
          pGrad.addColorStop(1, 'rgba(74, 222, 128, 0)');
          
          ctx.fillStyle = pGrad;
          ctx.beginPath(); 
          ctx.arc(x, y, 8, 0, Math.PI*2); 
          ctx.fill();
        });
        
        ctx.fillStyle = '#94a3b8';
        ctx.font = '14px monospace';
        ctx.textAlign = 'left';
        ctx.fillText(`dB/dt (Variação): ${inducedE.toFixed(2)}`, 20, h - 20);
        ctx.fillText(`Eletrodinâmica: ${electrons.length} partículas`, 20, h - 40);
      }
      anim = requestAnimationFrame(loop);
    };
    anim = requestAnimationFrame(loop);
    return () => cancelAnimationFrame(anim);
  }, [bFieldRate, electrons]); 

  return (
    <div className="grid md:grid-cols-2 gap-6">
      <Card title="Simulador: Betatron" subtitle="Acelerador Cíclico de Partículas" icon="circle-dot" className="md:col-span-2 lg:col-span-1">
         <div className="flex justify-center bg-slate-900 rounded-xl overflow-hidden shadow-2xl border border-slate-700 relative">
            <div className="absolute top-3 left-3 text-xs text-blue-400 font-mono border border-blue-900/50 px-2 py-1 rounded bg-blue-900/20 backdrop-blur-sm z-10">
              HIGH VACUUM CHAMBER
            </div>
            <canvas ref={canvasRef} style={{width: '100%', height: '450px'}} />
         </div>
         <div className="mt-6 space-y-4">
            <div>
              <label className="flex justify-between text-sm font-bold text-slate-600 mb-2">
                Taxa de Variação do Campo Magnético (dB/dt)
                <span className="text-blue-600 font-mono text-lg">{bFieldRate.toFixed(1)}</span>
              </label>
              <input type="range" min="0" max="5" step="0.1" value={bFieldRate} onChange={e => setBFieldRate(parseFloat(e.target.value))} className="w-full accent-blue-600 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"/>
              <div className="flex justify-between text-xs text-slate-400 mt-1">
                 <span>Estático</span>
                 <span>Variação Extrema</span>
              </div>
            </div>
         </div>
      </Card>
      
      <div className="flex flex-col gap-6 justify-center">
        <FormulaBlock 
          title="Lei de Faraday-Lenz"
          description="A variação do fluxo magnético no tempo induz um campo elétrico rotacional (E) que acelera as cargas ao longo da trajetória circular."
          formula="∮ E · dl = - dΦ/dt"
          quote='"O campo magnético variável age como um transformador, onde o feixe de elétrons é o enrolamento secundário." (Griffiths)'
        />
        
        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 p-6 rounded-xl text-sm text-blue-900 shadow-sm">
           <h4 className="font-bold mb-2 flex items-center gap-2 text-blue-700"><i data-lucide="info" className="w-4 h-4"></i> Guia Visual:</h4>
           <ul className="space-y-2 list-disc list-inside opacity-90">
             <li><strong>Centro Pulsante:</strong> Representa o campo magnético B variando no tempo.</li>
             <li><strong>Anel Amarelo:</strong> Indica a direção e intensidade do Campo Elétrico Induzido (E).</li>
             <li><strong>Partículas Verdes:</strong> Elétrons sendo acelerados tangencialmente.</li>
             <li><strong>Rastro:</strong> Visualização da velocidade angular crescente.</li>
           </ul>
        </div>

        <div className="p-4 bg-slate-800 rounded-lg border border-slate-700 text-slate-300 text-xs">
            <div className="flex justify-between items-center mb-1">
               <span>Raio da Órbita:</span>
               <span className="font-mono text-white">Constante (Design Betatron)</span>
            </div>
            <div className="w-full bg-slate-700 h-1 rounded overflow-hidden">
               <div className="bg-blue-500 h-full w-3/4"></div>
            </div>
        </div>
      </div>
    </div>
  );
};

// 2. ANEL SALTADOR (MANTIDO O SIMPLES/FLAT QUE VOCÊ GOSTOU)
const JumpingRingSim = () => {
  const [isOn, setIsOn] = useState(false);
  const [ringHeight, setRingHeight] = useState(0);
  const [velocity, setVelocity] = useState(0);
  const [hasIronCore, setHasIronCore] = useState(true);

  useEffect(() => {
    let anim;
    const loop = () => {
      const gravity = 0.5;
      const magneticPower = hasIronCore ? 20 : 3; 
      const noise = isOn ? (Math.random() - 0.5) * 0.5 : 0;
      const magForce = isOn ? Math.max(0, (magneticPower * 100) / (ringHeight + 20)) + noise : 0;
      
      let newVel = velocity + (magForce - gravity) * 0.1;
      newVel *= 0.95; 
      let newH = ringHeight + newVel;

      if (newH < 0) { newH = 0; newVel = -newVel * 0.3; } 
      if (newH > 240) { newH = 240; newVel = 0; } 

      setRingHeight(newH);
      setVelocity(newVel);
      anim = requestAnimationFrame(loop);
    };
    anim = requestAnimationFrame(loop);
    return () => cancelAnimationFrame(anim);
  }, [isOn, ringHeight, velocity, hasIronCore]);

  return (
    <div className="grid md:grid-cols-2 gap-8">
       <Card title="Simulador: Anel Saltador" subtitle="Lei de Lenz e Repulsão" icon="arrow-up-circle">
          {/* Fundo Claro Limpo, similar à imagem enviada */}
          <div className="relative h-96 bg-slate-50 rounded-xl border border-slate-200 flex flex-col justify-end items-center overflow-hidden shadow-inner isolate p-4">
             
             {/* Padrão de Fundo Sutil */}
             <div className="absolute inset-0 bg-[radial-gradient(#cbd5e1_1px,transparent_1px)] [background-size:20px_20px] opacity-30 -z-10"></div>

             {/* Haste Central (Núcleo) */}
             <div 
               className={`w-4 bg-gradient-to-r from-slate-400 to-slate-300 rounded-t-full transition-all duration-500 relative z-10`}
               style={{ height: hasIronCore ? '280px' : '0px', opacity: hasIronCore ? 1 : 0 }}
             ></div>
             
             {/* Haste Fina para o anel deslizar quando sem núcleo */}
             {!hasIronCore && <div className="absolute bottom-24 w-1 h-64 bg-slate-300 z-0"></div>}

             {/* O Anel */}
             <div 
               className={`absolute w-32 h-8 rounded-full border-4 border-slate-400 z-20 flex items-center justify-center transition-transform duration-75`}
               style={{ 
                 bottom: `${100 + ringHeight}px`,
                 background: 'linear-gradient(90deg, #e2e8f0, #f8fafc, #e2e8f0)',
                 boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
               }}
             >
                {/* Buraco do anel */}
                <div className="w-24 h-4 bg-slate-800/10 rounded-full"></div>

                {/* Brilho de corrente induzida */}
                {isOn && ringHeight < 150 && (
                   <div className="absolute inset-0 rounded-full border-2 border-red-400/50 animate-pulse shadow-[0_0_15px_rgba(248,113,113,0.5)]"></div>
                )}
             </div>

             {/* Base / Bobina (Estilo Bloco Listrado da Imagem) */}
             <div className="relative w-48 h-24 coil-pattern rounded-lg shadow-xl z-30 flex items-center justify-center border border-amber-900/20">
                <div className="bg-black/80 text-white text-[10px] font-bold px-3 py-1 rounded tracking-widest uppercase">
                   {hasIronCore ? "NÚCLEO FE" : "NÚCLEO AR"}
                </div>
             </div>
             
             {/* Base preta inferior */}
             <div className="w-56 h-4 bg-slate-800 rounded mt-[-2px] z-30"></div>

          </div>

          <div className="mt-6 flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-200">
             <div className="flex items-center gap-3">
                <label className="text-sm font-bold text-slate-700">Inserir Núcleo:</label>
                <button onClick={() => setHasIronCore(!hasIronCore)} className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${hasIronCore ? 'bg-slate-700' : 'bg-slate-300'}`}>
                   <div className={`w-4 h-4 bg-white rounded-full shadow transition-transform duration-300 ${hasIronCore ? 'translate-x-6' : 'translate-x-0'}`}></div>
                </button>
             </div>
             <button
               onMouseDown={() => setIsOn(true)}
               onMouseUp={() => setIsOn(false)}
               onMouseLeave={() => setIsOn(false)}
               className={`px-8 py-3 rounded-lg font-bold shadow-lg transition-all active:scale-95 flex items-center gap-2 border-b-4 
               ${isOn 
                  ? 'bg-red-500 text-white border-red-700 shadow-red-200' 
                  : 'bg-red-500 text-white border-red-700 hover:bg-red-600'}`}
             >
               <i data-lucide="power" className={isOn ? "animate-pulse" : ""}></i> {isOn ? "ENERGIZADO" : "LIGAR (SEGURE)"}
             </button>
          </div>
       </Card>

       <div className="flex flex-col gap-6">
          <FormulaBlock 
            title="Força de Repulsão"
            formula="F ∝ - ∇(M · B)"
            description="A variação rápida do fluxo ao ligar induz uma corrente oposta no anel (Lei de Lenz), criando um campo magnético que se opõe ao do solenoide."
            quote='"A corrente na espira é oposta à corrente no solenoide. E como correntes opostas se repelem, o anel salta."'
          />
          
          <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
             <h3 className="text-sm font-bold text-slate-500 mb-2 uppercase flex items-center gap-2">
                <i data-lucide="eye" className="w-4 h-4"></i> Detalhes Visuais
             </h3>
             <ul className="text-sm text-slate-600 space-y-2 list-disc list-inside">
                <li>O núcleo de ferro (mais escuro e central) concentra as linhas de campo, aumentando a força.</li>
                <li>Sem o núcleo, o campo dispersa e a força é insuficiente para o salto.</li>
                <li>O brilho vermelho indica o aquecimento por efeito Joule devido à alta corrente induzida.</li>
             </ul>
          </div>
       </div>
    </div>
  );
};

// 3. BARRA MÓVEL (VISUAL DARK - REPLICANDO A IMAGEM)
const FaradayFluxSim = () => {
  const [barPos, setBarPos] = useState(20); 
  const [lastPos, setLastPos] = useState(20);
  const [velocity, setVelocity] = useState(0);
  const [history, setHistory] = useState(new Array(100).fill(0));
  const timeRef = useRef(Date.now());
  const rafRef = useRef();

  useEffect(() => {
    const loop = () => {
      const now = Date.now();
      const dt = (now - timeRef.current) / 1000;
      
      if (dt > 0.05) { 
        const v = (barPos - lastPos) / dt;
        setVelocity(v);
        setLastPos(barPos);
        timeRef.current = now;

        setHistory(prev => {
          const next = [...prev, v * -1]; 
          if (next.length > 100) next.shift();
          return next;
        });
      }
      rafRef.current = requestAnimationFrame(loop);
    };
    rafRef.current = requestAnimationFrame(loop);
    return () => cancelAnimationFrame(rafRef.current);
  }, [barPos, lastPos]);

  const flux = barPos * 1.5; 
  const emf = velocity * -0.5;

  const polylinePoints = history.map((val, i) => {
      const x = i * (100 / history.length);
      const y = 50 - (val * 2);
      return `${x},${y}`;
  }).join(' ');

  return (
    <div className="grid lg:grid-cols-2 gap-6 h-full">
      <div className="flex flex-col gap-6">
        <Card title="Simulador: Barra Móvel" subtitle="Gerando Eletricidade com Movimento" icon="maximize">
          <div className="relative h-72 bg-slate-900 rounded-xl border border-slate-700 flex items-center justify-center p-8 overflow-hidden shadow-inner isolate">
            
            {/* Padrão de Pontos (Fundo Dark) */}
            <div className="absolute inset-0 bg-dots opacity-40 pointer-events-none"></div>

            {/* Container do Trilho */}
            <div className="relative w-full h-32 flex items-center">
              
              {/* Trilhos (Linhas Finas) */}
              <div className="absolute top-0 w-full h-[1px] bg-slate-600"></div>
              <div className="absolute bottom-0 w-full h-[1px] bg-slate-600"></div>

              {/* Área do Fluxo (Preenchimento Azul) */}
              <div 
                className="absolute left-0 top-[1px] bottom-[1px] bg-blue-600/20 border-r border-blue-500/50 transition-all duration-75 z-0 flex items-center justify-center overflow-hidden"
                style={{ width: `${barPos}%` }}
              >
                 <div className="text-center">
                    <span className="text-blue-100 font-bold text-lg opacity-90 block">Fluxo Φ</span>
                    <span className="text-blue-300 text-[10px] font-mono block">Φ = B · A</span>
                 </div>
              </div>

              {/* A Barra Móvel (Amarela/Dourada Brilhante) */}
              <div 
                className="absolute w-6 h-40 bg-amber-500 rounded-md cursor-grab active:cursor-grabbing shadow-[0_0_15px_rgba(245,158,11,0.5)] flex flex-col items-center justify-center z-20 hover:scale-105 transition-transform border border-amber-300"
                style={{ left: `calc(${barPos}% - 12px)` }}
              >
                 {/* Detalhe interno da barra */}
                 <div className="w-1 h-32 bg-amber-200/50 rounded-full"></div>
              </div>
            </div>
          </div>

          <div className="mt-6">
            <label className="flex justify-between text-sm font-bold text-slate-600 mb-2">
               Posição da Barra (Área da Espira)
               <span className="text-blue-600 font-mono">{barPos.toFixed(0)} cm</span>
            </label>
            <input 
              type="range" min="0" max="100" 
              value={barPos} onChange={e => setBarPos(parseFloat(e.target.value))}
              className="w-full slider-amber"
            />
          </div>
        </Card>
      </div>

      <div className="flex flex-col gap-6">
        <FormulaBlock 
          title="Lei de Faraday"
          description="A fem é gerada pela variação do fluxo magnético."
          formula="ε = -dΦ/dt = -BLv"
          quote="A regra do fluxo diz que a fem é igual à taxa negativa de variação do fluxo magnético."
        />

        <Card title="Monitoramento" icon="activity">
          <div className="grid grid-cols-1 gap-4 mb-4">
             <div className="bg-slate-50 p-4 rounded border border-slate-200 flex justify-between items-center">
                <span className="text-xs font-bold uppercase text-slate-500">Fluxo (Φ)</span>
                <span className="text-2xl font-mono font-bold text-blue-600">{flux.toFixed(1)} Wb</span>
             </div>
             <div className="bg-slate-50 p-4 rounded border border-slate-200 flex justify-between items-center">
                <span className="text-xs font-bold uppercase text-slate-500">Fem (ε)</span>
                <span className={`text-2xl font-mono font-bold transition-colors ${Math.abs(emf) > 1 ? 'text-amber-500' : 'text-slate-400'}`}>
                  {Math.abs(emf).toFixed(1)} V
                </span>
             </div>
          </div>

          <div className="h-40 bg-slate-900 rounded border border-slate-700 relative overflow-hidden">
             <div className="absolute top-2 left-2 text-xs text-slate-500 font-mono">Gráfico: Fem vs Tempo</div>
             <div className="absolute inset-0 flex items-center">
               <div className="w-full border-t border-slate-700 border-dashed"></div>
             </div>
             <svg className="w-full h-full" preserveAspectRatio="none" viewBox="0 0 100 100">
               <polyline 
                 points={polylinePoints}
                 fill="none"
                 stroke="#f59e0b"
                 strokeWidth="2"
                 vectorEffect="non-scaling-stroke"
               />
             </svg>
          </div>
        </Card>
      </div>
    </div>
  );
};


// --- SIMULADORES ORIGINAIS (PRESERVADOS) ---

const LenzSimulator = () => {
  const [magnetX, setMagnetX] = useState(50); 
  const [velocity, setVelocity] = useState(0);
  const lastX = useRef(50);
  const lastTime = useRef(Date.now());

  useEffect(() => {
    let af;
    const update = () => {
      const now = Date.now();
      const dt = (now - lastTime.current) / 1000;
      if (dt > 0) {
        const dx = magnetX - lastX.current;
        const v = dx / (dt * 100);
        setVelocity(prev => prev * 0.9 + v * 0.1);
        lastX.current = magnetX;
        lastTime.current = now;
      }
      af = requestAnimationFrame(update);
    };
    af = requestAnimationFrame(update);
    return () => cancelAnimationFrame(af);
  }, [magnetX]);

  const current = velocity * -1;
  const opacity = Math.min(Math.abs(current) * 2, 1);
  const ledColor = current > 0 ? 'rgb(239, 68, 68)' : 'rgb(34, 197, 94)';
  const coilLoops = [0, 1, 2, 3, 4, 5];
  const coilSpacing = 45; 
  const coilStartX = 187; 
  const coilYTop = 68;      
  const coilYBottom = 188; 

  return (
    <div className="grid lg:grid-cols-3 gap-6">
      <div className="lg:col-span-2">
        <Card title="Experimento de Indução" subtitle="Movimente o ímã através da bobina" icon="move">
          <div className="relative h-64 bg-slate-100 rounded-xl overflow-hidden border border-slate-200 shadow-inner flex items-center select-none">
            <svg viewBox="0 0 600 256" preserveAspectRatio="xMidYMid meet" className="absolute inset-0 w-full h-full z-0 pointer-events-none">
                <defs>
                   <linearGradient id="wireBack" x1="0%" y1="0%" x2="0%" y2="100%">
                     <stop offset="0%" stopColor="#7c2d12" /> 
                     <stop offset="100%" stopColor="#451a03" />
                   </linearGradient>
                </defs>
                {coilLoops.map(i => {
                    const x = coilStartX + (i * coilSpacing);
                    return (
                        <path 
                            key={`back-${i}`}
                            d={`M ${x},${coilYTop} Q ${x - 20},${(coilYTop+coilYBottom)/2} ${x},${coilYBottom}`}
                            fill="none" 
                            stroke="url(#wireBack)" 
                            strokeWidth="14" 
                            strokeLinecap="round"
                        />
                    );
                })}
            </svg>

            <div 
              className="absolute z-10 w-48 h-16 shadow-2xl rounded flex overflow-hidden cursor-grab active:cursor-grabbing border border-black/20"
              style={{ 
                  left: `${10 + (magnetX * 0.8)}%`, 
                  top: '50%', 
                  transform: 'translate(-50%, -50%)',
                  boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.3)'
              }}
            >
              <div className="flex-1 bg-gradient-to-r from-blue-700 to-blue-500 flex items-center justify-center text-white font-black text-2xl border-r border-black/10">S</div>
              <div className="flex-1 bg-gradient-to-r from-red-500 to-red-700 flex items-center justify-center text-white font-black text-2xl border-l border-white/10">N</div>
              <div className="absolute inset-0 bg-gradient-to-b from-white/30 to-transparent pointer-events-none"></div>
            </div>

            <svg viewBox="0 0 600 256" preserveAspectRatio="xMidYMid meet" className="absolute inset-0 w-full h-full z-20 pointer-events-none">
                <defs>
                   <linearGradient id="wireFront" x1="0%" y1="0%" x2="0%" y2="100%">
                     <stop offset="0%" stopColor="#b45309" /> 
                     <stop offset="50%" stopColor="#f59e0b" /> 
                     <stop offset="100%" stopColor="#b45309" />
                   </linearGradient>
                </defs>
                {coilLoops.map(i => {
                    const x = coilStartX + (i * coilSpacing);
                    return (
                        <g key={`front-${i}`}>
                            <path 
                                d={`M ${x},${coilYBottom} Q ${x + 20},${(coilYTop+coilYBottom)/2} ${x + coilSpacing},${coilYTop}`}
                                fill="none" 
                                stroke="url(#wireFront)" 
                                strokeWidth="14" 
                                strokeLinecap="round"
                            />
                            <path 
                                d={`M ${x},${coilYBottom} Q ${x + 20},${(coilYTop+coilYBottom)/2} ${x + coilSpacing},${coilYTop}`}
                                fill="none" 
                                stroke={ledColor}
                                strokeWidth="6" 
                                strokeLinecap="round"
                                opacity={opacity}
                                className="transition-opacity duration-75 blur-[2px]"
                            />
                        </g>
                    );
                })}
            </svg>
          </div>

          <div className="mt-6 px-4">
            <input 
              type="range" min="0" max="100" step="0.1"
              value={magnetX} 
              onChange={(e) => setMagnetX(parseFloat(e.target.value))}
              className="w-full accent-blue-600"
            />
            <div className="flex justify-between text-xs font-bold text-slate-400 mt-2 uppercase tracking-wider">
              <span>Exterior (Esq)</span>
              <span>Centro da Bobina</span>
              <span>Exterior (Dir)</span>
            </div>
          </div>
        </Card>
      </div>

      <div className="flex flex-col gap-6">
        <Card title="Galvanômetro" icon="gauge">
            <div className="relative h-40 flex items-end justify-center pb-4">
              <div className="absolute top-0 w-full h-full flex justify-center">
                <svg viewBox="0 0 200 120" className="w-full h-full">
                  <path d="M20,110 A80,80 0 0,1 180,110" fill="none" stroke="#cbd5e1" strokeWidth="20" strokeLinecap="round"/>
                  <path d="M100,110 L100,20" stroke="#e2e8f0" strokeWidth="1" strokeDasharray="4 4"/>
                  <g style={{ transform: `rotate(${Math.max(-80, Math.min(80, velocity * 120))}deg)`, transformOrigin: '100px 110px', transition: 'transform 0.1s cubic-bezier(0,0,0.2,1)' }}>
                    <path d="M98,110 L100,10 L102,110" fill="#dc2626" />
                    <circle cx="100" cy="110" r="6" fill="#1e293b" />
                  </g>
                </svg>
              </div>
              <div className="absolute top-2/3 text-center">
                <div className={`text-2xl font-mono font-bold transition-colors ${Math.abs(current) > 0.1 ? (current > 0 ? 'text-red-600' : 'text-green-600') : 'text-slate-400'}`}>
                  {(current * 100).toFixed(1)} mA
                </div>
              </div>
            </div>
        </Card>

        <FormulaBlock 
          title="Lei de Lenz"
          description="A corrente induzida possui um sentido tal que o campo magnético que ela cria se opõe à variação do fluxo magnético original."
          formula="ε = -dΦ/dt"
          quote='"A natureza abomina mudanças no fluxo".'
        />
      </div>
    </div>
  );
};

const CoaxialEnergySim = () => {
  const [current, setCurrent] = useState(2);
  const [a, setA] = useState(20); 
  const [b, setB] = useState(80); 
  
  const drawEnergyDensity = (ctx, w, h) => {
      const cx = w/2;
      const cy = h/2;
      ctx.fillStyle = '#f8fafc'; 
      ctx.fillRect(0,0,w,h);

      const maxRadius = b * 2; 
      const minRadius = a * 2;

      for (let r = maxRadius; r >= minRadius; r -= 1) {
        const s = r;
        const density = (current * current) / (s * s);
        const intensity = Math.min(density * 20000, 1); 
        
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, 2*Math.PI);
        ctx.fillStyle = `rgba(59, 130, 246, ${intensity})`;
        ctx.fill();
      }

      ctx.beginPath();
      ctx.arc(cx, cy, minRadius, 0, 2*Math.PI);
      ctx.fillStyle = '#b45309'; 
      ctx.fill();
      ctx.strokeStyle = '#78350f';
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(cx, cy, maxRadius, 0, 2*Math.PI);
      ctx.strokeStyle = '#334155';
      ctx.lineWidth = 4;
      ctx.stroke();
  };

  const totalEnergy = 0.1 * (current * current) * Math.log(b/a);

  return (
    <div className="grid lg:grid-cols-2 gap-6">
       <div className="flex flex-col gap-6">
         <Card title="Simulador: Cabo Coaxial" subtitle="Distribuição de Energia Magnética" icon="layers">
            <div className="flex flex-col gap-6">
               <div className="flex flex-col gap-2">
                  <label className="text-sm font-bold text-slate-600 flex justify-between">
                     Corrente (I) <span className="font-mono text-blue-600">{current} A</span>
                  </label>
                  <input type="range" min="0" max="10" step="0.1" value={current} onChange={e=>setCurrent(+e.target.value)} className="w-full accent-blue-600"/>
               </div>
               <div className="flex flex-col gap-2">
                  <label className="text-sm font-bold text-slate-600 flex justify-between">
                     Raio Interno (a) <span className="font-mono text-slate-500">{a} mm</span>
                  </label>
                  <input type="range" min="10" max="40" value={a} onChange={e=>setA(+e.target.value)} className="w-full accent-amber-600"/>
               </div>
               <div className="flex flex-col gap-2">
                  <label className="text-sm font-bold text-slate-600 flex justify-between">
                     Raio Externo (b) <span className="font-mono text-slate-500">{b} mm</span>
                  </label>
                  <input type="range" min="50" max="100" value={b} onChange={e=>setB(+e.target.value)} className="w-full accent-slate-600"/>
               </div>
            </div>
         </Card>
         
         <FormulaBlock 
           title="Energia Magnética"
           description="A energia armazenada no campo magnético entre os condutores depende do quadrado da corrente e da geometria."
           formula="W = (μ₀I²l / 4π) ln(b/a)"
           quote="A energia por unidade de volume é B²/2μ₀."
         />
         
         <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
            <h4 className="text-sm font-bold text-slate-600 mb-2 uppercase flex items-center gap-2">
              <i data-lucide="calculator" className="w-4 h-4"></i> Resultados
            </h4>
            <div className="bg-slate-100 p-4 rounded border border-slate-200 flex justify-between items-center">
              <span className="text-xs font-bold uppercase text-slate-500">Energia Total (W)</span>
              <span className="text-2xl font-mono text-blue-600">{totalEnergy.toFixed(2)} µJ/m</span>
            </div>
         </div>

       </div>

       <Card title="Corte Transversal (Visualização)" icon="eye">
         <div className="flex justify-center bg-slate-50 rounded-lg border border-slate-200 overflow-hidden h-[300px]">
            <GraphCanvas drawFn={drawEnergyDensity} width={300} height={300} className="w-full h-full" />
         </div>
         <div className="mt-4 text-sm text-slate-500 text-center">
            A cor <span className="text-blue-500 font-bold">azul</span> representa a densidade de energia magnética (u). 
            Note como a energia se concentra perto do condutor interno (raio a), onde o campo B é mais forte.
         </div>
       </Card>
    </div>
  );
};

const ACGenerator = () => {
  const [active, setActive] = useState(false);
  const [angle, setAngle] = useState(0);
  const [magnetStrength, setMagnetStrength] = useState(1.0); 
  const [history, setHistory] = useState(new Array(200).fill(0));
  const reqRef = useRef();

  useEffect(() => {
    const animate = () => {
      if (active) {
        setAngle(a => (a + 4) % 360);
      }
      reqRef.current = requestAnimationFrame(animate);
    };
    reqRef.current = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(reqRef.current);
  }, [active]);

  useEffect(() => {
    const val = Math.sin(angle * Math.PI / 180) * magnetStrength;
    setHistory(prev => {
      const next = [...prev, val];
      if (next.length > 200) next.shift();
      return next;
    });
  }, [angle, magnetStrength]);

  const voltage = Math.sin(angle * Math.PI / 180) * magnetStrength;
  const flux = Math.cos(angle * Math.PI / 180) * magnetStrength;

  return (
    <div className="grid lg:grid-cols-2 gap-6 h-full">
      <div className="flex flex-col gap-6">
        <Card title="Simulador: Gerador AC" icon="rotate-cw" className="flex-grow">
          <div className="h-64 bg-slate-100 rounded-xl relative overflow-hidden flex items-center justify-center">
            <div className="absolute w-full px-12 flex justify-between pointer-events-none z-10">
              <div className="w-12 h-32 bg-red-600 rounded-l-lg shadow-lg flex items-center justify-center text-white font-bold text-2xl border border-red-800" style={{opacity: 0.5 + (magnetStrength/4)}}>N</div>
              <div className="w-12 h-32 bg-blue-600 rounded-r-lg shadow-lg flex items-center justify-center text-white font-bold text-2xl border border-blue-800" style={{opacity: 0.5 + (magnetStrength/4)}}>S</div>
            </div>

            <div className="absolute inset-0 flex flex-col justify-center gap-4 opacity-10">
               {[1,2,3,4,5].map(i => <div key={i} className="h-0.5 w-full bg-slate-800"></div>)}
            </div>

            <div 
              className="w-40 h-24 border-[6px] border-amber-500 bg-amber-500/10 rounded relative z-20 shadow-xl"
              style={{ 
                transform: `perspective(800px) rotateY(${angle}deg)`,
                transformStyle: 'preserve-3d'
              }}
            >
              <div className="absolute inset-0 border-2 border-white/30"></div>
            </div>
          </div>

          <div className="mt-6 flex flex-col gap-4">
             <div className="flex justify-center">
                <button 
                  onClick={() => setActive(!active)}
                  className={`flex items-center gap-2 px-6 py-3 rounded-full font-bold text-white shadow-lg transition-transform active:scale-95
                  ${active ? 'bg-red-500 hover:bg-red-600' : 'bg-green-600 hover:bg-green-700'}`}
                >
                  <i data-lucide={active ? "pause" : "play"} className="fill-current w-4 h-4"></i>
                  {active ? "Parar Rotação" : "Iniciar Rotação"}
                </button>
             </div>

             <div className="bg-slate-50 p-4 rounded border border-slate-200">
                <label className="flex justify-between text-sm font-bold text-slate-600 mb-2">
                   Força do Ímã (B)
                   <span className="text-blue-600 font-mono">{magnetStrength.toFixed(1)} T</span>
                </label>
                <input 
                   type="range" min="0.5" max="3.0" step="0.1"
                   value={magnetStrength} 
                   onChange={(e) => setMagnetStrength(parseFloat(e.target.value))}
                   className="w-full accent-indigo-600"
                />
             </div>
          </div>
        </Card>
      </div>

      <div className="flex flex-col gap-6">
        <Card title="Osciloscópio (Saída)" icon="activity">
           <Oscilloscope 
             dataLines={[
               { data: history, color: '#34d399' }
             ]}
             height={200}
             yRange={3.2} 
             timeScale={5}
           />
           
           <div className="mt-4 grid grid-cols-2 gap-4">
             <div className="bg-slate-50 border border-slate-200 p-3 rounded text-center">
               <div className="text-xs uppercase font-bold text-slate-400">Fluxo (Φ)</div>
               <div className="text-xl font-mono font-bold text-blue-600">{flux.toFixed(2)} Wb</div>
             </div>
             <div className="bg-slate-50 border border-slate-200 p-3 rounded text-center">
               <div className="text-xs uppercase font-bold text-slate-400">Fem (ε)</div>
               <div className="text-xl font-mono font-bold text-green-600">{voltage.toFixed(2)} V</div>
             </div>
           </div>
        </Card>
        
        <FormulaBlock 
          title="Princípio do Gerador"
          description="A rotação da espira altera o ângulo θ, variando o fluxo Φ = B·A·cos(θ)."
          formula="ε = BAω sin ωt"
        />
      </div>
    </div>
  );
};

const TransformerSim = () => {
  const [vp, setVp] = useState(110);
  const [np, setNp] = useState(500);
  const [ns, setNs] = useState(250);
  const [t, setT] = useState(0);

  const [waveData, setWaveData] = useState({ in: [], out: [] });

  useEffect(() => {
    let frame;
    const loop = () => {
      setT(prev => prev + 0.1);
      frame = requestAnimationFrame(loop);
    };
    loop();
    return () => cancelAnimationFrame(frame);
  }, []);

  useEffect(() => {
    const points = 200;
    const inputWave = [];
    const outputWave = [];
    const ratio = ns / np;
    const vs = vp * ratio;

    for (let i = 0; i < points; i++) {
      const theta = (i * 0.1) + t;
      inputWave.push(Math.sin(theta) * (vp / 240));
      outputWave.push(Math.sin(theta) * (vs / 240)); 
    }
    setWaveData({ in: inputWave, out: outputWave });
  }, [t, vp, np, ns]);

  const vs = vp * (ns / np);
  
  let typeLabel = "Isolador";
  let typeIcon = "minus";
  if (vs > vp) { typeLabel = "Elevador (Step-Up)"; typeIcon = "trending-up"; } 
  else if (vs < vp) { typeLabel = "Rebaixador (Step-Down)"; typeIcon = "trending-down"; }

  return (
    <div className="grid md:grid-cols-12 gap-6">
      <div className="md:col-span-4 flex flex-col gap-6">
        <Card title="Simulador: Transformador" icon="sliders">
          <div className="space-y-6">
            <div>
              <label className="flex justify-between text-sm font-bold text-slate-600 mb-2">
                Tensão Entrada (Vp)
                <span className="text-blue-600 font-mono">{vp} V</span>
              </label>
              <input type="range" min="10" max="220" value={vp} onChange={e=>setVp(+e.target.value)} className="w-full"/>
            </div>
            
            <div className="p-4 bg-slate-50 rounded-lg border border-slate-200">
               <div className="text-xs font-bold text-slate-400 uppercase mb-3">Enrolamentos</div>
               <div className="space-y-4">
                 <div>
                   <div className="flex justify-between text-xs mb-1">
                     <span>Primário (Np)</span>
                     <span className="font-mono">{np} espiras</span>
                   </div>
                   <input type="range" min="100" max="1000" step="50" value={np} onChange={e=>setNp(+e.target.value)} className="w-full accent-amber-600"/>
                 </div>
                 <div>
                   <div className="flex justify-between text-xs mb-1">
                     <span>Secundário (Ns)</span>
                     <span className="font-mono">{ns} espiras</span>
                   </div>
                   <input type="range" min="100" max="1000" step="50" value={ns} onChange={e=>setNs(+e.target.value)} className="w-full accent-amber-600"/>
                 </div>
               </div>
            </div>

            <div className="bg-slate-800 text-white p-4 rounded-lg text-center">
              <div className="text-xs uppercase opacity-60 mb-1">Relação de Transformação</div>
              <div className="text-2xl font-mono font-bold text-yellow-400">
                1 : {(ns/np).toFixed(2)}
              </div>
            </div>
          </div>
        </Card>
      </div>

      <div className="md:col-span-8 flex flex-col gap-6">
        <Card title="Análise de Sinais" icon="activity">
          <Oscilloscope 
            dataLines={[
              { data: waveData.in, color: '#3b82f6' },
              { data: waveData.out, color: '#ef4444' }
            ]}
            height={240}
            yRange={1.5}
            timeScale={16}
          />
          <div className="flex justify-center gap-6 mt-4 text-sm font-medium">
            <div className="flex items-center gap-2">
              <span className="w-3 h-3 rounded-full bg-blue-500"></span>
              <span className="text-slate-600">Entrada (Primário)</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="w-3 h-3 rounded-full bg-red-500"></span>
              <span className="text-slate-600">Saída (Secundário)</span>
            </div>
          </div>
        </Card>

        <div className="grid grid-cols-2 gap-4">
           <FormulaBlock 
             title="Indutância Mútua"
             formula="Φ₂ = M₂₁ I₁"
             quote="O fluxo através de 2 é proporcional à corrente em 1."
           />
           
           <div className="bg-white border border-slate-200 p-4 rounded-xl shadow-sm flex flex-col justify-between">
             <div>
               <div className="text-xs font-bold text-slate-400 uppercase">Tensão Saída</div>
               <div className={`text-3xl font-mono font-black mt-2 ${vs > 220 ? 'text-red-600' : 'text-slate-800'}`}>
                 {vs.toFixed(0)} V
               </div>
             </div>
             <div className="flex justify-between items-end">
                 <div className="text-xs text-slate-400">Vs = Vp × (Ns/Np)</div>
                 <div className="flex items-center gap-2 text-sm font-bold text-blue-600">
                    {typeLabel}
                    <i data-lucide={typeIcon}></i>
                 </div>
             </div>
           </div>
        </div>
      </div>
    </div>
  );
};

const EddyBrake = () => {
  const [active, setActive] = useState(false);
  const [angle, setAngle] = useState(45);
  const [velocity, setVelocity] = useState(0);
  const raf = useRef();

  useEffect(() => {
    const loop = () => {
      const g = 0.5;
      const accel = -g * Math.sin(angle * Math.PI / 180);
      
      let nextV = velocity + accel;
      nextV *= 0.995; 

      if (active && Math.abs(angle) < 25) {
        nextV *= 0.85; 
      }

      setVelocity(nextV);
      setAngle(a => a + nextV);
      
      raf.current = requestAnimationFrame(loop);
    };
    raf.current = requestAnimationFrame(loop);
    return () => cancelAnimationFrame(raf.current);
  }, [active, angle, velocity]);

  const reset = () => {
    setAngle(45);
    setVelocity(0);
  };

  return (
    <div className="grid md:grid-cols-2 gap-8">
      <Card title="Simulador: Freio Magnético" icon="anchor" className="h-[400px]">
        <div className="relative h-full bg-slate-50 rounded-xl border border-slate-200 flex justify-center overflow-hidden">
           
           <div className="absolute top-0 w-32 h-4 bg-slate-300 rounded-b-lg z-20"></div>

           <div 
             className="absolute top-2 origin-top flex flex-col items-center"
             style={{ height: '80%', transform: `rotate(${angle}deg)` }}
           >
             <div className="w-1 h-full bg-slate-400"></div>
             <div className="w-24 h-24 bg-gradient-to-br from-amber-200 to-amber-500 rounded border border-amber-600 shadow-xl flex items-center justify-center relative">
                {active && Math.abs(angle) < 25 && Math.abs(velocity) > 0.5 && (
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="w-16 h-16 border-4 border-red-500/50 rounded-full animate-spin-slow border-dashed"></div>
                  </div>
                )}
                <span className="text-[10px] font-bold text-amber-900 uppercase opacity-50">Metal</span>
             </div>
           </div>

           <div className={`absolute bottom-0 transition-all duration-500 z-30 ${active ? 'translate-y-0 opacity-100' : 'translate-y-12 opacity-40 grayscale'}`}>
             <div className="flex items-end gap-6">
               <div className="w-10 h-32 bg-red-600 rounded-t border-2 border-red-800 shadow-xl flex justify-center pt-2 text-white font-bold">N</div>
               <div className="w-10 h-32 bg-blue-600 rounded-t border-2 border-blue-800 shadow-xl flex justify-center pt-2 text-white font-bold">S</div>
             </div>
             {active && <div className="absolute top-8 left-10 right-10 h-0.5 bg-slate-400/50 dashed"></div>}
           </div>

        </div>
      </Card>

      <div className="flex flex-col justify-center space-y-6">
        <FormulaBlock 
           title="Correntes de Foucault"
           description="Quando o condutor se move através do campo, correntes circulantes são induzidas, dissipando energia e frenando o movimento."
           formula="F ~ -v"
           quote="O freio magnético opera sob o princípio da Lei de Lenz."
        />

        <div className="grid grid-cols-2 gap-4">
          <button 
             onClick={() => setActive(!active)}
             className={`p-4 rounded-xl border-2 font-bold flex flex-col items-center gap-2 transition-all
             ${active ? 'bg-red-50 border-red-500 text-red-700 shadow-inner' : 'bg-white border-slate-200 text-slate-500 hover:border-blue-400 shadow-sm'}`}
          >
            <i data-lucide="magnet" className="w-8 h-8"></i>
            {active ? "CAMPO ATIVO" : "CAMPO INATIVO"}
          </button>

          <button 
             onClick={reset}
             className="p-4 rounded-xl border-2 border-slate-200 bg-white hover:bg-slate-50 text-slate-700 font-bold flex flex-col items-center gap-2 shadow-sm"
          >
            <i data-lucide="rotate-ccw" className="w-8 h-8"></i>
            REINICIAR
          </button>
        </div>
      </div>
    </div>
  );
};

const RLCResonance = () => {
  const [R, setR] = useState(50);
  const [L, setL] = useState(100);
  const [C, setC] = useState(50);
  const [freq, setFreq] = useState(60);

  const omega = 2 * Math.PI * freq;
  const XL = omega * (L / 1000);
  const XC = 1 / (omega * (C / 1000000));
  const Z = Math.sqrt(R*R + (XL - XC)**2);
  const I_max = 120 / Z; 
  
  const f_res = 1 / (2 * Math.PI * Math.sqrt((L/1000) * (C/1000000)));

  const drawResponseCurve = (ctx, w, h) => {
    ctx.beginPath();
    ctx.strokeStyle = '#10b981';
    ctx.lineWidth = 2;
    
    const maxGraphFreq = f_res * 3;
    const scaleY = h / (120/R) * 0.8;

    for(let x = 0; x < w; x++) {
      const f = (x / w) * maxGraphFreq;
      if (f === 0) continue;
      const w_curr = 2 * Math.PI * f;
      const xl = w_curr * (L/1000);
      const xc = 1 / (w_curr * (C/1000000));
      const z = Math.sqrt(R*R + (xl-xc)**2);
      const i = 120/z;
      const y = h - (i * scaleY);
      x === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    }
    ctx.stroke();

    const currX = (freq / maxGraphFreq) * w;
    const currY = h - (I_max * scaleY);
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(currX, currY, 5, 0, Math.PI*2); ctx.fill();
    
    const resX = (f_res / maxGraphFreq) * w;
    ctx.strokeStyle = '#fbbf24'; ctx.setLineDash([2,2]);
    ctx.beginPath(); ctx.moveTo(resX, 0); ctx.lineTo(resX, h); ctx.stroke();
  };

  return (
    <div className="grid lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 flex flex-col gap-4">
         <Card title="Componentes RLC" icon="cpu">
           <div className="space-y-4">
             <div>
               <div className="flex justify-between text-xs font-bold text-slate-600 mb-1">
                  <span>Resistência (R)</span> <span>{R} Ω</span>
               </div>
               <input type="range" min="10" max="200" value={R} onChange={e=>setR(+e.target.value)} className="w-full accent-slate-600"/>
             </div>
             <div>
               <div className="flex justify-between text-xs font-bold text-slate-600 mb-1">
                  <span>Indutância (L)</span> <span>{L} mH</span>
               </div>
               <input type="range" min="10" max="500" value={L} onChange={e=>setL(+e.target.value)} className="w-full accent-blue-500"/>
             </div>
             <div>
               <div className="flex justify-between text-xs font-bold text-slate-600 mb-1">
                  <span>Capacitância (C)</span> <span>{C} μF</span>
               </div>
               <input type="range" min="1" max="200" value={C} onChange={e=>setC(+e.target.value)} className="w-full accent-red-500"/>
             </div>
             <div>
               <div className="flex justify-between text-sm font-bold text-slate-800 mt-4 mb-1">
                  <span>Frequência da Fonte</span> 
                  <span className={Math.abs(freq - f_res) < 5 ? 'text-green-600 font-black' : ''}>{freq} Hz</span>
               </div>
               <input type="range" min="10" max="300" value={freq} onChange={e=>setFreq(+e.target.value)} className="w-full accent-slate-800"/>
               <div className="text-xs text-center text-slate-400 mt-1">Ressonância em: {f_res.toFixed(1)} Hz</div>
             </div>
           </div>

           <div className="bg-[#111827] p-4 rounded-lg mt-6 font-mono text-sm grid grid-cols-2 gap-y-2 border border-slate-700 shadow-inner">
             <div className="flex justify-between pr-2">
               <span className="text-slate-400 font-bold">X_L:</span>
               <span className="text-blue-400 font-bold">{XL.toFixed(1)}Ω</span>
             </div>
             <div className="flex justify-between pl-2">
               <span className="text-slate-400 font-bold">X_C:</span>
               <span className="text-red-400 font-bold">{XC.toFixed(1)}Ω</span>
             </div>
             <div className="col-span-2 border-t border-slate-700 my-1"></div>
             <div className="flex justify-between col-span-2">
                <span className="text-white font-bold">Z (Imp):</span>
                <span className="text-white font-bold">{Z.toFixed(1)}Ω</span>
             </div>
             <div className="flex justify-between col-span-2">
                <span className="text-[#34d399] font-bold">I (RMS):</span>
                <span className="text-[#34d399] font-bold">{I_max.toFixed(2)}A</span>
             </div>
           </div>

           <div className="mt-4">
             <FormulaBlock 
                title="Autoindutância"
                description="A fem autoinduzida opõe-se à variação da corrente."
                formula="ε = -L(dI/dt)"
             />
           </div>

         </Card>
      </div>

      <div className="lg:col-span-1">
          <Card title="Diagrama de Fasores (Vetores)" icon="maximize-2">
             <div className="h-[300px] flex items-center justify-center bg-slate-900 rounded-lg relative overflow-hidden">
                <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.05)_1px,transparent_1px)] bg-[size:20px_20px]"></div>
                <div className="absolute w-full h-[1px] bg-slate-700"></div>
                <div className="absolute h-full w-[1px] bg-slate-700"></div>
                
                <div className="relative w-full h-full">
                    <div className="absolute top-1/2 left-1/2 h-1 bg-amber-400 origin-left rounded-full" style={{ width: `${Math.min(R, 140)}px`, transform: 'translateY(-50%)' }}></div>
                    <div className="absolute top-1/2 left-1/2 w-1 bg-blue-500 origin-bottom rounded-full" style={{ height: `${Math.min(XL, 140)}px`, transform: 'translate(-50%, -100%)' }}></div>
                    <div className="absolute top-1/2 left-1/2 w-1 bg-red-500 origin-top rounded-full" style={{ height: `${Math.min(XC, 140)}px`, transform: 'translate(-50%, 0)' }}></div>
                    <div className="absolute top-1/2 left-1/2 h-1 bg-green-500 origin-left rounded-full opacity-80" 
                         style={{ 
                           width: `${Math.min(Z, 140)}px`, 
                           transform: `translateY(-50%) rotate(${-Math.atan2(XL-XC, R) * 180 / Math.PI}deg)` 
                         }}></div>
                </div>
                <div className="absolute text-white text-xs font-mono top-1/2 left-1/2 ml-4 -mt-8">
                    φ={(-Math.atan2(XL-XC, R) * 180 / Math.PI).toFixed(1)}°
                </div>
             </div>
             <div className="flex justify-center gap-4 mt-2 text-xs font-bold">
                <span className="text-amber-500">● R</span>
                <span className="text-blue-500">● XL</span>
                <span className="text-red-500">● XC</span>
                <span className="text-green-500">● Z Total</span>
             </div>
          </Card>
      </div>

      <div className="lg:col-span-1">
        <Card title="Curva de Resposta em Frequência" icon="activity">
           <GraphCanvas drawFn={drawResponseCurve} width={300} height={300} className="w-full h-[300px] bg-slate-900" />
           <div className="text-center text-xs text-slate-500 mt-2">Eixo X: Frequência (Hz) | Eixo Y: Corrente (A)</div>
           
           <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800">
             Na ressonância, a impedância é mínima (Z = R) e a corrente é máxima.
           </div>
        </Card>
      </div>
    </div>
  );
};

const RailgunSim = () => {
  const [charging, setCharging] = useState(false);
  const [charge, setCharge] = useState(0);
  const [fired, setFired] = useState(false);
  const [projX, setProjX] = useState(0);
  const [kineticEnergy, setKineticEnergy] = useState(0);
  
  const voltage = 5000;
  const capacitance = 0.5; // mF
  const bField = 2;
  const mass = 0.05; // 50g projectile

  const maxEnergy = 0.5 * (capacitance/1000) * (voltage * voltage); 
  
  useEffect(() => {
    let interval;
    if (charging && charge < 100) {
      interval = setInterval(() => setCharge(c => Math.min(c + 2, 100)), 50);
    }
    return () => clearInterval(interval);
  }, [charging, charge]);

  useEffect(() => {
    if (fired) {
      setKineticEnergy(0);
      let startTime = Date.now();
      const chargeFactor = charge / 100;
      const maxForce = ((voltage * capacitance * bField) / 100) * chargeFactor; 

      const anim = setInterval(() => {
        const t = (Date.now() - startTime) / 1000;
        const accel = maxForce / mass; 
        const newPos = (0.5 * maxForce * t * t) * 500;
        const currentVelocity = (maxForce * t) * 10; 

        setProjX(Math.min(newPos, 600));
        setKineticEnergy(0.5 * mass * currentVelocity * currentVelocity);

        if (newPos > 600) {
          clearInterval(anim);
          setFired(false);
          setProjX(0);
          setCharge(0);
          setCharging(false);
        }
      }, 16);
      return () => clearInterval(anim);
    }
  }, [fired]);

  return (
    <div className="flex flex-col gap-6">
      <Card title="Simulador: Railgun" icon="zap">
        <div className="relative h-48 bg-slate-900 rounded border border-slate-700 overflow-hidden shadow-inner flex items-center px-8">
           <div className="absolute top-1/2 left-0 w-full h-8 -translate-y-1/2 flex flex-col justify-between">
             <div className="w-full h-2 bg-gradient-to-r from-yellow-600 to-yellow-300 shadow-[0_0_10px_rgba(234,179,8,0.5)]"></div>
             <div className="w-full h-2 bg-gradient-to-r from-yellow-600 to-yellow-300 shadow-[0_0_10px_rgba(234,179,8,0.5)]"></div>
           </div>

           <div 
             className="absolute w-12 h-8 bg-slate-200 z-10 rounded-sm shadow-white"
             style={{ left: `${50 + projX}px`, top: '50%', transform: 'translateY(-50%)' }}
           >
             {fired && <div className="absolute right-full top-0 h-full w-32 bg-gradient-to-l from-blue-400 to-transparent opacity-80 blur-md"></div>}
           </div>
        </div>

        <div className="mt-6 flex items-center gap-8">
           <div className="flex-1">
             <div className="flex justify-between text-sm mb-2 font-bold text-slate-600">
               <span>Carga do Banco ({voltage}V)</span>
               <span>{charge}%</span>
             </div>
             <div className="h-4 bg-slate-200 rounded-full overflow-hidden border border-slate-300">
               <div 
                 className={`h-full transition-all duration-300 ${charge > 90 ? 'bg-green-500' : 'bg-blue-600'}`} 
                 style={{ width: `${charge}%` }}
               ></div>
             </div>
           </div>

           <div className="flex gap-4">
             <button 
               onMouseDown={() => setCharging(true)}
               onMouseUp={() => setCharging(false)}
               disabled={fired}
               className="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold rounded shadow border-b-4 border-slate-400 active:border-b-0 active:translate-y-1 transition-all disabled:opacity-50"
             >
               CARREGAR
             </button>
             <button 
               onClick={() => setFired(true)}
               disabled={charge < 10 || fired}
               className="px-8 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded shadow-lg shadow-red-500/30 border-b-4 border-red-800 active:border-b-0 active:translate-y-1 transition-all disabled:bg-slate-300 disabled:border-slate-400 disabled:text-slate-500 disabled:shadow-none"
             >
               DISPARAR
             </button>
           </div>
        </div>
      </Card>
      
      <div className="grid md:grid-cols-2 gap-6">
          <FormulaBlock 
             title="Energia Magnética"
             description="A energia armazenada no capacitor é convertida em energia magnética e, posteriormente, cinética."
             formula="W = (1/2μ₀) ∫ B² dτ"
             quote="A energia fica 'armazenada no campo magnético', na quantidade (B²/2μ₀) por unidade de volume."
          />

          <div className="p-6 bg-slate-800 rounded-xl border border-slate-700 text-white shadow-lg">
             <h3 className="font-bold text-yellow-400 flex items-center gap-2 mb-4">
                <i data-lucide="zap" className="w-5 h-5"></i> Conversão de Energia
             </h3>
             <div className="space-y-4">
                <div className="flex justify-between items-center border-b border-slate-700 pb-2">
                   <span className="text-sm text-slate-400">Energia Armazenada (E)</span>
                   <span className="font-mono text-lg font-bold">{(maxEnergy * (charge/100)).toFixed(0)} J</span>
                </div>
                <div className="flex justify-between items-center">
                   <span className="text-sm text-slate-400">Energia Cinética (K)</span>
                   <span className="font-mono text-2xl font-black text-green-400">{kineticEnergy.toFixed(1)} J</span>
                </div>
             </div>
          </div>
      </div>
    </div>
  );
};

const App = () => {
  const [tab, setTab] = useState('betatron');

  useEffect(() => {
    setTimeout(() => lucide.createIcons(), 50);
  }, [tab]);

  const tabs = [
    { id: 'betatron', label: 'O Betatron', icon: 'circle-dot', theme: 'Campo Elétrico Induzido' },
    { id: 'jumpingRing', label: 'Anel Saltador', icon: 'arrow-up-circle', theme: 'Lei de Lenz e Força' },
    { id: 'lenz', label: 'Lei de Lenz', icon: 'zap', theme: 'Indução Eletromagnética' },
    { id: 'faraday', label: 'Barra Móvel', icon: 'maximize', theme: 'Lei de Faraday' }, 
    { id: 'coaxial', label: 'Cabo Coaxial', icon: 'layers', theme: 'Energia Magnética' }, 
    { id: 'ac', label: 'Gerador AC', icon: 'rotate-cw', theme: 'Geradores e Motores' },
    { id: 'transformer', label: 'Transformador', icon: 'settings-2', theme: 'Indutância Mútua' },
    { id: 'brake', label: 'Freio Magnético', icon: 'anchor', theme: 'Correntes de Foucault' },
    { id: 'rlc', label: 'Circuito RLC', icon: 'activity', theme: 'Autoindutância e Ressonância' },
    { id: 'railgun', label: 'Railgun', icon: 'crosshair', theme: 'Força Magnética e Energia' },
  ];

  const currentInfo = tabs.find(t => t.id === tab);

  return (
    <div className="min-h-screen flex flex-col">
      <header className="bg-slate-900 border-b border-slate-800 sticky top-0 z-50 text-white shadow-lg">
        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="bg-blue-600 p-1.5 rounded-lg">
              <i data-lucide="activity" className="w-5 h-5 text-white"></i>
            </div>
            <div>
              <h1 className="text-lg font-bold tracking-tight">FARADAY LAB <span className="text-blue-400 font-normal">PRO</span></h1>
            </div>
          </div>

          <nav className="hidden md:flex bg-slate-800 p-1 rounded-lg">
            {tabs.map(t => (
              <button
                key={t.id}
                onClick={() => setTab(t.id)}
                className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2
                  ${tab === t.id ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-700/50'}`}
              >
                {t.label}
              </button>
            ))}
          </nav>
        </div>
      </header>

      <div className="bg-[#1e293b] text-white shadow-md border-b border-slate-700">
         <div className="max-w-6xl mx-auto px-4 py-6 flex flex-col justify-center items-center text-center">
             <h2 className="text-3xl font-bold mb-4 tracking-tight text-slate-100">{currentInfo.label}</h2>
             <div className="h-1.5 w-64 bg-slate-700 rounded-full mb-3 overflow-hidden">
                <div className="h-full bg-blue-500 w-1/2 rounded-full mx-auto"></div>
             </div>
             <h3 className="text-sm font-mono text-blue-400 uppercase tracking-widest font-bold">{currentInfo.theme}</h3>
         </div>
      </div>
      
      <div className="md:hidden bg-slate-800 overflow-x-auto">
         <div className="flex p-2 gap-2 w-max">
            {tabs.map(t => (
              <button
                key={t.id}
                onClick={() => setTab(t.id)}
                className={`px-3 py-2 rounded text-xs font-bold whitespace-nowrap
                  ${tab === t.id ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300'}`}
              >
                {t.label}
              </button>
            ))}
         </div>
      </div>

      <main className="flex-grow bg-slate-50 p-4 md:p-8">
        <div className="max-w-6xl mx-auto">
          {tab === 'betatron' && <BetatronSim />}
          {tab === 'jumpingRing' && <JumpingRingSim />}
          {tab === 'lenz' && <LenzSimulator />}
          {tab === 'faraday' && <FaradayFluxSim />} 
          {tab === 'coaxial' && <CoaxialEnergySim />}
          {tab === 'ac' && <ACGenerator />}
          {tab === 'transformer' && <TransformerSim />}
          {tab === 'brake' && <EddyBrake />}
          {tab === 'rlc' && <RLCResonance />}
          {tab === 'railgun' && <RailgunSim />}
        </div>
      </main>

      <footer className="bg-white border-t border-slate-200 py-8 text-center text-slate-400 text-sm">
        <p>© 2025 Faraday Lab Simulator - Cesar Yuri, Ítalo Pimentel, Rayssa Mirelle, Everson Eduardo, Paulo Fernando - Eletromagnetismo - Professor Everton.</p>
        <p className="mt-2 text-xs">Renderizado com React + TailwindCSS + HTML Canvas</p>
      </footer>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

</script>
</body>
</html>